jQuery(document).ready(function(e){var t=function(){var t=e('input[name="stockticker_defaults[all_symbols]"]').val().toString().split(",").length*e('input[name="stockticker_defaults[timeout]"]').val()*1.5;e("#fetch_timeout_advisor .min").html(Math.ceil(t))};e('input[name="stockticker_defaults[cache_timeout]"]').after('&nbsp;<span id="fetch_timeout_advisor">at least <span class="min"></span></span>'),t(),e('input[name="stockticker_defaults[timeout]"], input[name="stockticker_defaults[all_symbols]"]').on("change click keydown",function(e){t()}),e('button[name="st_force_data_fetch_stop"]').on("click",function(t){t.preventDefault(),e(this).data("stop","true")});var a=function(t){e('button[name="st_force_data_fetch"], input[name="st_symbol_search_keywords"], button[name="st_symbol_search_test_button"], input[name="st_symbol_search_test"], select[name="st_symbol_search_test_endpoint"]').prop("disabled",t)},s=function(){return 60/e('select[name="stockticker_defaults[av_api_tier]"]').val()*1e3};e('button[name="st_force_data_fetch"]').on("click",function(t){t.preventDefault();var o=e('button[name="st_force_data_fetch_stop"]'),n=s();a(!0),e(o).addClass("enabled"),e.ajax({type:"post",dataType:"json",async:!0,url:stockTickerJs.ajax_url,data:{action:"stockticker_purge_cache"}}).done(function(t){function s(){e.ajax({type:"post",dataType:"json",async:!0,url:stockTickerJs.ajax_url,data:{action:"stockticker_update_quotes"}}).done(function(t){if(t.done||"true"==e(o).data("stop"))"DONE"!=t.message?e(".st_force_data_fetch").append("<br />["+t.symbol+"] "+t.message):e(".st_force_data_fetch").append("<br />DONE"),e(o).removeClass("enabled").data("stop","false"),a(!1);else{stockTickerJs.avurl;"wait"==t.method?e(".st_force_data_fetch").append("[WAIT] "+t.message+"<br />"):t.message.indexOf("Operation timed out")>=0?e(".st_force_data_fetch").append("[Timeout] "+t.symbol+"<br />"):t.message.indexOf("Invalid API call")>=0?e(".st_force_data_fetch").append("[Invalid API call] "+t.symbol+' (<a href="'+stockTickerJs.avurl+t.symbol+'" target="_blank">test</a>)<br />'):t.message.indexOf("Bad API response")>=0?e(".st_force_data_fetch").append("[Bad API response] "+t.symbol+' (<a href="'+stockTickerJs.avurl+t.symbol+'" target="_blank">test</a> OR try to prefix stock symbol with stock exchange)<br />'):e(".st_force_data_fetch").append("[OK] "+t.symbol+"<br />"),setTimeout(function(){s()},n)}}).fail(function(t){e(".st_force_data_fetch").append("<br />[Error] "+t.message)})}e(".st_force_data_fetch").html("Reset fetching loop and fetch data again. We`ll make pause "+n/1e3+" second(s) between each symbol fetch. Please wait...<br /><br />"),s()})}),e('button[name="st_symbol_search_test_button"]').on("click",function(t){t.preventDefault();var o=e('input[name="st_symbol_search_test"]').val();if(0!=o.length){var n=e('select[name="st_symbol_search_test_endpoint"]').val();if(0!=n.length){var c=s();a(!0),e(".st_symbol_search_test_log").html("<pre>Lookup for <em>"+o+"</em> on API endpoint <em>"+n+"</em> and waiting <em>"+c/1e3+"</em> seconds until next action...\n\n</pre>"),e.ajax({type:"post",dataType:"json",async:!0,url:stockTickerJs.ajax_url,data:{action:"stockticker_symbol_search_test",symbol:o,endpoint:n}}).done(function(t){e(".st_symbol_search_test_log pre").append(t.message),setTimeout(function(){a(!1)},c)}).fail(function(t){e(".st_symbol_search_test_log pre").append(t.message),setTimeout(function(){a(!1)},c)})}else e(".st_symbol_search_test_log").append('<p class="error">Please select AlphaVantage.co API endpoint from dropdown above!</p>')}else e(".st_symbol_search_test_log").append('<p class="error">Please enter keyword or symbol to search or test!</p>')})});